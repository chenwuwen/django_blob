{% extends 'base.html' %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/css/blog_view.css"/>
{% endblock %}

{% block main %}

    <div class="pui-layout">
        {% include 'component/header.html' %}
        <div class="pui-container pui-layout-fixed pui-layout-fixed-1200 pui-grid blog-main">
            <div class="pui-row">
                {% include 'blog/blog_setting_slide.html' %}

                <div class="pui-grid-xs-6 pui-grid-sm-8 pui-grid-md-9 pui-grid-lg-9 pui-grid-xl-9 pui-grid-xxl-9">
                    <form class="pui-form pui-input-sm-large pui-input-md-large pui-grid">
                        <div class="pui-row pui-form-group">
                            <div class="pui-grid-sm-12 pui-grid-md-12">
                                <input name="title" type="text" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜"/>
                            </div>
                        </div>
                        <div class="pui-row pui-form-group">
                            <div id="editor" class="pui-grid-sm-12 pui-grid-md-12">

                            </div>
                        </div>

                        <div class="pui-row pui-form-group pui-form-group-underline-dashed">
                            <label class="pui-grid-sm-12 pui-grid-md-1.5">æ–‡ç« æ ‡ç­¾ï¼š</label>
                            <div class="pui-grid-sm-12 pui-grid-md-10">
                                <input name="" type="text" style="width:50%;">(å¤šä¸ªå…³é”®å­—ä¹‹é—´ç”¨â€œ,â€åˆ†éš”ï¼Œæœ€å¤šä¸è¶…è¿‡10ä¸ª)
                            </div>
                        </div>

                        <div class="pui-row pui-form-group pui-form-group-underline-dashed">
                            <label class="pui-grid-sm-12 pui-grid-md-1.5">ä¸ªäººåˆ†ç±»ï¼š
                                <span><i class="fa fa-plus-square-o fa-1x pui-text-blue-400">&nbsp;æ·»åŠ æ–°çš„åˆ†ç±»</i></span>
                            </label>


                            <div class="pui-grid-sm-12 pui-grid-md-8">
                                <div class="pui-card pui-card-default pui-card-box">
                                    {% for self_sort in self_sort_list %}
                                        <pui-checkbox name="self_sort"
                                                      value="{{ self_sort.id }}">{{ self_sort.name }}
                                        </pui-checkbox>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="pui-row pui-form-group pui-form-group-underline-dashed">
                            <div class="pui-grid-sm-12 pui-grid-md-5">
                                <label class="">æ–‡ç« ç±»å‹ï¼š</label>
                                <div class="pui-select">
                                    <select name="type">
                                        <option value="">è¯·é€‰æ‹©æ–‡ç« ç±»å‹</option>
                                        <option value="åŸåˆ›">åŸåˆ›</option>
                                        <option value="è½¬è½½">è½¬è½½</option>
                                        <option value="ç¿»è¯‘">ç¿»è¯‘</option>
                                    </select>
                                </div>
                            </div>
                            <div class="pui-grid-sm-12 pui-grid-md-5">
                                <label class="">åšå®¢åˆ†ç±»ï¼š</label>
                                <div class="pui-select">
                                    <select name="classification">
                                        <option value="">è¯·é€‰æ‹©åšå®¢åˆ†ç±»</option>
                                        {% for blog_classification in  blog_classification_list %}
                                            <option value="{{ blog_classification.id }}">{{ blog_classification.name }}</option>
                                        {% endfor %}


                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="pui-row pui-form-group pui-form-group-underline-dashed">
                            <div class="pui-grid-sm-12 pui-grid-md-10">
                                <label>ç§å¯†æ–‡ç« ï¼š</label>
                                <pui-switch-slide name="open" width="60" color="orange" on-color="gray"
                                                  off-color="green" class="pui-round pui-switch-slide-animation"
                                                  style="width: 64px; background-color: green; color: green;">
                                    <span change="æ˜¯" class="">å¦</span>
                                </pui-switch-slide>
                            </div>
                        </div>
                        <div class="pui-row pui-form-group pui-form-group-underline-dashed">
                            <button type="button" class="pui-btn pui-btn-default pui-btn-secondary publish_blog">
                                å‘å¸ƒåšå®¢ <span class="arrow-down"></span>
                            </button>
                            <button type="button" class="pui-btn pui-btn-info ">
                                ä¿å­˜è‰ç¨¿ <span class="arrow-down"></span>
                            </button>
                            <button type="button" class="pui-btn pui-btn-default pui-btn-large">
                                è¿”å› <span class="arrow-down"></span>
                            </button>
                        </div>
                    </form>
                </div>

            </div>

        </div>
    </div>
    {% include 'component/footer.html' %}
    </div>
{% endblock %}
{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}wangEditor-3.1.1/release/wangEditor.js"></script>
    <script type="text/javascript">
        {#        ç›‘å¬å›è½¦äº‹ä»¶,ç¦æ­¢è¡¨å•å›è½¦è‡ªåŠ¨æäº¤,ç‚¹å‡»å›è½¦æ—¶,æ”¹å˜ä¸ºæ¢è¡Œç¬¦#}
        $(document).keyup(function (event) {
            if (event.keyCode == 13) {
                event.keyCode = 9
            }
        });

        {#        åˆå§‹åŒ–ç¼–è¾‘å™¨#}
        var E = window.wangEditor
        var editor = new E('#editor')
        // æˆ–è€… var editor = new E( document.getElementById('editor') )'
        // è‡ªå®šä¹‰èœå•é…ç½®
        editor.customConfig.menus = [
            'head',  // æ ‡é¢˜
            'bold',  // ç²—ä½“
            'fontSize',  // å­—å·
            'fontName',  // å­—ä½“
            'italic',  // æ–œä½“
            'underline',  // ä¸‹åˆ’çº¿
            'strikeThrough',  // åˆ é™¤çº¿
            'foreColor',  // æ–‡å­—é¢œè‰²
            'backColor',  // èƒŒæ™¯é¢œè‰²
            'link',  // æ’å…¥é“¾æ¥
            'list',  // åˆ—è¡¨
            'justify',  // å¯¹é½æ–¹å¼
            'quote',  // å¼•ç”¨
            'emoticon',  // è¡¨æƒ…
            'image',  // æ’å…¥å›¾ç‰‡
            'table',  // è¡¨æ ¼
            'video',  // æ’å…¥è§†é¢‘
            'code',  // æ’å…¥ä»£ç 
            'undo',  // æ’¤é”€
            'redo'  // é‡å¤
        ]

        // è¡¨æƒ…é¢æ¿å¯ä»¥æœ‰å¤šä¸ª tab ï¼Œå› æ­¤è¦é…ç½®æˆä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ª tab çš„é…ç½®
        {#        editor.customConfig.emotions = [#}
        {#            {#}
        {#                // tab çš„æ ‡é¢˜#}
        {#                title: 'é»˜è®¤',#}
        {#                // type -> 'emoji' / 'image'#}
        {#                type: 'image',#}
        {#                // content -> æ•°ç»„#}
        {#                content: [#}
        {#                    {#}
        {#                        alt: '[åç¬‘]',#}
        {#                        src: 'http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/50/pcmoren_huaixiao_org.png'#}
        {#                    },#}
        {#                    {#}
        {#                        alt: '[èˆ”å±]',#}
        {#                        src: 'http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/pcmoren_tian_org.png'#}
        {#                    }#}
        {#                ]#}
        {#            },#}
        {#            {#}
        {#                // tab çš„æ ‡é¢˜#}
        {#                title: 'emoji',#}
        {#                // type -> 'emoji' / 'image'#}
        {#                type: 'emoji',#}
        {#                // content -> æ•°ç»„#}
        {#                content: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†']#}
        {#            }#}
        {#        ]#}


        // é€šè¿‡ url å‚æ•°é…ç½® debug æ¨¡å¼ã€‚url ä¸­å¸¦æœ‰ wangeditor_debug_mode=1 æ‰ä¼šå¼€å¯ debug æ¨¡å¼,(debugæ¨¡å¼ä¸‹ï¼Œæœ‰ JS é”™è¯¯ä¼šä»¥throw Erroræ–¹å¼æç¤ºå‡ºæ¥ã€‚é»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸ä¼šæŠ›å‡ºå¼‚å¸¸)
        editor.customConfig.debug = location.href.indexOf('wangeditor_debug_mode=1') > 0


        // å…³é—­ç²˜è´´æ ·å¼çš„è¿‡æ»¤(å½“ä»å…¶ä»–ç½‘é¡µå¤åˆ¶æ–‡æœ¬å†…å®¹ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ï¼Œç¼–è¾‘å™¨ä¼šé»˜è®¤è¿‡æ»¤æ‰å¤åˆ¶æ–‡æœ¬ä¸­è‡ªå¸¦çš„æ ·å¼ï¼Œç›®çš„æ˜¯è®©ç²˜è´´åçš„æ–‡æœ¬å˜å¾—æ›´åŠ ç®€æ´å’Œè½»é‡ã€‚ç”¨æˆ·å¯é€šè¿‡editor.customConfig.pasteFilterStyle = falseæ‰‹åŠ¨å…³é—­æ‰ç²˜è´´æ ·å¼çš„è¿‡æ»¤ã€‚)
        editor.customConfig.pasteFilterStyle = false
        // å¿½ç•¥ç²˜è´´å†…å®¹ä¸­çš„å›¾ç‰‡(ä»å…¶ä»–é¡µé¢å¤åˆ¶è¿‡æ¥çš„å†…å®¹ï¼Œé™¤äº†åŒ…å«æ–‡å­—è¿˜å¯èƒ½åŒ…å«å›¾ç‰‡ï¼Œè¿™äº›å›¾ç‰‡ä¸€èˆ¬éƒ½æ˜¯å¤–åŸŸçš„ï¼ˆå¯èƒ½ä¼šæœ‰ç›—é“¾ï¼‰ã€‚æ­¤æ—¶å¦‚æœæƒ³è¦å¿½ç•¥å›¾ç‰‡ï¼Œå³åªç²˜è´´æ–‡å­—ä¸ç²˜è´´å›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨editor.customConfig.pasteIgnoreImg = trueæ¥æ§åˆ¶ã€‚é»˜è®¤æ˜¯å¯ä»¥ç²˜è´´å›¾ç‰‡çš„)
        editor.customConfig.pasteIgnoreImg = false
        // è‡ªå®šä¹‰å¤„ç†ç²˜è´´çš„æ–‡æœ¬å†…å®¹
        editor.customConfig.pasteTextHandle = function (content) {
            // content å³ç²˜è´´è¿‡æ¥çš„å†…å®¹ï¼ˆhtml æˆ– çº¯æ–‡æœ¬ï¼‰ï¼Œå¯è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ç„¶åè¿”å›
            return content + '<br/>'
        }
        editor.create()


        $(".publish_blog").on('click', function () {

            var title = $("form input[name='title']").val().trim();
            var type = $("form select[name='type']").val()
            var classification = $("form select[name='classification']").val()
            var open = $("form  input[name='open']").val()
            var self_sorts = []
            $("form  input[name='self_sort']").each(function () {
                if ($(this)[0].hasAttribute("checked")) {
                    self_sorts.push($(this).val())
                }
            })

            {#            ä»wangeditor3è¯»å–å†…å®¹#}
            {#            éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»ç¼–è¾‘å™¨ä¸­è·å–çš„ html ä»£ç æ˜¯ä¸åŒ…å«ä»»ä½•æ ·å¼çš„çº¯ htmlï¼Œå¦‚æœæ˜¾ç¤ºçš„æ—¶å€™éœ€è¦å¯¹å…¶ä¸­çš„<table><code><blockquote>ç­‰æ ‡ç­¾è¿›è¡Œè‡ªå®šä¹‰æ ·å¼ï¼ˆè¿™æ ·æ—¢å¯å®ç°å¤šçš®è‚¤åŠŸèƒ½ï¼‰#}
            var content = editor.txt.html()  // è¯»å– html
            {#            var content = editor.txt.text()  // è¯»å– text#}

            if (title == "" || title == "null" || type == "" || classification == "" || content == "" || content == "null") {
                layer.msg('è¯·å°†å†…å®¹å¡«å†™å®Œæ•´', {
                    time: 2000,//2såè‡ªåŠ¨å…³é—­
                    //skin:'warning-class',  //è‡ªå®šä¹‰æ ·å¼
                })
                return false
            }

            var blog = new FormData()
            blog.append("title", title);
            blog.append("content", content);
            blog.append("type", type);
            blog.append("classification", classification);
            blog.append("open", open);
            blog.append("selfSort", self_sorts.join(','));
            $.ajax({
                url: "/blog/write_blog/",
                type: 'post',
                data: blog,
                processData: false,  // å‘Šè¯‰jQueryä¸è¦å»å¤„ç†å‘é€çš„æ•°æ®
                contentType: false,  // å‘Šè¯‰jQueryä¸è¦å»è®¾ç½®Content-Typeè¯·æ±‚å¤´
                success: function (data) {
                    if (data.status) {
                        layer.msg("å‘å¸ƒæˆåŠŸ",function () {
                            
                        })
                    } else {

                    }
                },
                error: function () {

                }
            })
        })
    </script>
{% endblock %}